# Документация функционала

-----

## 1. Создание и управление аккаунтами

### Функциональность:

`Этот функционал позволяет управлять аккаунтами пользователей, включая их создание, обновление, удаление и получение данных.`

***Основные операции***:

	- Создание аккаунта: Через эндпоинт /accounts/ осуществляется создание нового аккаунта в базе данных. При этом можно указать данные пользователя, такие как имя, номер телефона и статус.
	- Получение аккаунтов: Эндпоинт /accounts/ возвращает все аккаунты, хранящиеся в базе данных, с возможностью фильтрации и пагинации.
	- Получение аккаунта по ID: Для получения данных конкретного аккаунта по его ID используется эндпоинт /accounts/{account_id}.
	- Обновление аккаунта: Эндпоинт /accounts/{account_id} позволяет обновить информацию о существующем аккаунте, например, изменить имя, номер телефона или статус.
    - Удаление аккаунта: При удалении аккаунта через эндпоинт /accounts/{account_id} аккаунт удаляется из базы данных.

***Технические детали***:

	- Используется асинхронная работа с базой данных через SQLAlchemy.
	- Вся информация об аккаунтах хранится в таблице accounts базы данных.
	- При создании нового аккаунта проверяются уникальность номера телефона и корректность данных.
	- В случае неудачи (например, аккаунт не найден при запросе по ID) возвращается ошибка с кодом 404.

⸻

## 2. Управление прокси

### Функциональность:

`Для обеспечения безопасности и избежания блокировок ботов используется система прокси, позволяющая управлять подключениями ботов через различные IP-адреса.`

***Основные операции***:

	- Добавление нового прокси: Через соответствующий эндпоинт можно добавить новый прокси в базу данных.
	- Получение прокси: Прокси можно получить через соответствующие эндпоинты, чтобы использовать их для работы с клиентами Telegram.
	- Удаление прокси: Прокси можно удалить, если оно больше не используется.

***Технические детали***:

	- Прокси хранятся в таблице proxies.
	- Каждое подключение к Pyrogram будет использовать случайный прокси из списка для обхода блокировок.
	- Прокси SOCKS5

⸻

## 3. Комментирование и реакция на посты

### Функциональность:

`Система комментирования и реакции на посты позволяет автоматизировать процесс взаимодействия с постами в Telegram.`

***Основные операции***:

	- Автоматическое комментирование: Боты могут комментировать посты в каналах, выполняя задачи, поставленные пользователем. Комментарии могут быть позитивными, нейтральными, критикующими или вопросительным в зависимости от настроек.
	- Автоматические реакции: Реакции (лайки, эмодзи) могут быть автоматически поставлены на посты в зависимости от условий.
	- Рандомизация комментариев и реакций: Для того чтобы сделать взаимодействие более естественным, время между комментариями и реакциями рандомизируется, а также их содержание может быть вариативным.

***Технические детали***:

	- Для каждого действия (комментирование или реакция) используется Pyrogram.
	- Время между действиями рассчитывается с учётом случайной вариации (±20%).
	- Для комментирования используется OpenAI для генерации текстов на основе промптов.

⸻

## 4. Просмотр сообщений

### Функциональность:

`Функционал просмотра сообщений позволяет ботам автоматически просматривать посты или комментарии в каналах.`

***Основные операции***:

	- Автоматический просмотр постов: Боты могут просматривать посты, что позволяет повысить их активность в канале.
	- Параллельные просмотры: Система позволяет запускать параллельные процессы для одновременного просмотра нескольких постов с разных аккаунтов.
	- Рандомизация времени: Время между действиями также варьируется, что делает поведение ботов более естественным.

***Технические детали***:

	- Для каждого бота создается отдельная сессия Pyrogram.
	- Просмотр осуществляется путём вызова метода get_messages.
	- Время действия рассчитывается случайным образом с учётом заданного отклонения.

⸻

## 5. Авторизация и управление сессиями

### Функциональность:

`Система авторизации и управления сессиями использует Pyrogram для входа в аккаунты Telegram через номер телефона.`

***Основные операции***:

	- Отправка кода подтверждения: Боты отправляют код подтверждения на номер телефона при первом запуске.
	- Вход в аккаунт: После получения кода и ввода пароля (если требуется двухфакторная аутентификация), бот авторизуется в Telegram.
	- Управление сессиями: Каждый аккаунт имеет уникальную сессию, которая сохраняется на диске.

***Технические детали***:

	- Каждая сессия сохраняется в файле с уникальным именем, основанным на номере телефона.
	- Для управления сессиями используется Pyrogram в связке с базой данных для хранения информации о статусе аккаунтов.
	- Прокси могут быть использованы для обхода ограничений Telegram.

⸻

## 6. Масштабируемость и управление нагрузкой

### Функциональность:

`Для эффективного масштабирования и работы с большим количеством аккаунтов система поддерживает масштабируемость с использованием прокси, асинхронных операций и очередей.`

***Основные операции***:

	- Масштабирование до тысяч аккаунтов: Система может поддерживать до 5000 аккаунтов, каждый из которых работает через отдельную сессию.
	- Использование очередей сообщений: Для эффективного распределения задач между ботами используется Redis Streams, что позволяет минимизировать нагрузку на систему.
	- Ограничение по IP: Использование прокси помогает избежать блокировки по IP-адресу, что также повышает устойчивость системы.

***Технические детали***:

	- Для масштабирования можно(будет) использовать Redis Streams/kafka и асинхронный клиент redis.asyncio.
	- Все процессы выполняются асинхронно, что позволяет обрабатывать запросы от множества аккаунтов одновременно.